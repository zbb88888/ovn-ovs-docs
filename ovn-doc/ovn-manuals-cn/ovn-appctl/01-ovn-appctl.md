# ovn-appctl(8)

## 名称

ovn-appctl - 配置运行中的 OVN 守护进程的实用程序

## 概要

`ovn-appctl [-target=target | -t target] [-T secs | -timeout=secs] command [arg...]`

`ovn-appctl -help`

`ovn-appctl -version`

## 描述

OVN 守护进程在运行时接受某些命令以控制其行为并查询其设置。每个守护进程都接受下面“通用命令”中记录的一组通用命令。某些守护进程支持在其自己的手册页中记录的其他命令。

`ovn-appctl` 程序提供了一种调用这些命令的简单方法。要发送的命令在 `ovn-appctl` 的命令行上指定为非选项参数。`ovn-appctl` 发送命令并将守护进程的响应打印在标准输出上。

`ovn-appctl` 相当于 Open vSwitch 的 `ovs-appctl` 实用程序。

## 通用命令

每个 OVN 守护进程都支持一组通用命令，本节对此进行了记录。

### 一般命令

这些命令显示特定于守护进程的命令和运行版本。请注意，这些命令与返回有关 `ovn-appctl` 实用程序本身信息的 `-help` 和 `-version` 选项不同。

-   `list-commands`
    列出目标支持的命令。

-   `version`
    显示目标的版本和编译日期。

### 日志命令

OVN 有几个日志级别。最高严重性的日志级别是：

-   `off`
    在此级别永远不会记录任何消息，因此将日志目标的日志级别设置为 `off` 会禁用对该目标的日志记录。

以下日志级别按严重性降序排列：

-   `emer`
    重大故障导致进程强制停止。

-   `err`
    高级操作或子系统失败。值得关注。

-   `warn`
    低级操作失败，但高级子系统可能能够恢复。

-   `info`
    回顾调查问题时可能有用的信息。

-   `dbg`
    仅对深入了解系统的人员有用的信息，或者通常会导致日志输出量过大的信息。默认情况下不记录此级别的日志消息。

每个 OVN 守护进程都支持以下命令来检查和调整日志级别。

-   `vlog/list`
    列出已知的日志记录模块及其当前级别。

-   `vlog/list-pattern`
    列出每个目标使用的日志记录模式。

-   `vlog/set [spec]`
    设置日志记录级别。如果不带任何 `spec`，则将每个模块和目标的日志级别设置为 `dbg`。否则，`spec` 是由空格、逗号或冒号分隔的单词列表，每个类别最多一个：

    -   有效的模块名称，如 `ovn-appctl(8)` 上的 `vlog/list` 命令所示，将日志级别更改限制为指定的模块。

    -   `syslog`、`console` 或 `file`，分别将日志级别更改限制为仅系统日志、控制台或文件。

        在 Windows 平台上，接受 `syslog` 作为一个词，并且仅当目标使用 `--syslog-target` 选项启动时才有用（否则该词无效）。

    -   `off`、`emer`、`err`、`warn`、`info` 或 `dbg`，用于控制日志级别。将记录给定严重性或更高严重性的消息，并过滤掉较低严重性的消息。`off` 过滤掉所有消息。

    在 `spec` 中大小写不敏感。

-   `vlog/set PATTERN:destination: pattern`
    将 `destination` 的日志模式设置为 `pattern`。每次将消息记录到 `destination` 时，`pattern` 决定消息的格式。`pattern` 中的大多数字符都按字面意思复制到日志中，但以 `%` 开头的特殊转义符将按如下方式扩展：

    -   `%A` : 记录消息的应用程序名称，例如 `ovn-controller`。

    -   `%B` : 消息的 RFC5424 syslog PRI。

    -   `%c` : 记录消息的模块名称（如 `ovn-appctl -list` 所示）。

    -   `%d` : ISO 8601 格式的当前日期和时间 (YYYY-MM-DD HH:MM:SS)。

    -   `%d{format}` : 指定格式的当前日期和时间，该格式采用与 `strftime(3)` 的模板参数相同的格式。作为扩展，`format` 中的任何 `#` 字符都将被替换为小数秒，例如使用 `%H:%M:%S.###` 表示精确到毫秒的时间。亚秒级时间仅是近似值，目前小数点后三位之后总是报告为零。

    -   `%D` : ISO 8601 格式的当前 UTC 日期和时间 (YYYY-MM-DD HH:MM:SS)。

    -   `%D{format}` : 指定格式的当前 UTC 日期和时间，该格式采用与 `strftime(3)` 的模板参数相同的格式。支持与 `%d{...}` 相同的亚秒分辨率扩展。

    -   `%E` : 运行应用程序的节点的主机名。

    -   `%m` : 正在记录的消息。

    -   `%N` : 程序此运行中此消息的序列号，为十进制数。程序记录的第一条消息的序列号为 1，第二条为 2，依此类推。

    -   `%n` : 换行符。

    -   `%p` : 记录消息的级别，例如 `DBG`。

    -   `%P` : 程序的进程 ID (pid)，为十进制数。

    -   `%r` : 从应用程序启动到记录消息时经过的毫秒数。

    -   `%t` : 子程序名称，即发出日志消息的进程或线程的标识名称，例如用于 `-monitor` 的进程的 `monitor` 或程序中主进程或线程的 `main`。

    -   `%T` : 括在括号中的子程序名称，例如 `(monitor)`，或者对于程序中的主进程或线程为空字符串。

    -   `%%` : 字面上的 `%`。

    一些选项可能会出现在 `%` 和格式说明符字符之间，顺序如下：

    -   `-` :在其字段宽度内左对齐转义的扩展。默认为右对齐。

    -   `0` : 用 0 填充字段到字段宽度。默认为用空格填充。

    -   `width` : 指定最小字段宽度的数字。如果转义扩展为少于 `width` 个字符，则将其填充以填充字段宽度。（宽于 `width` 的字段不会被截断以适应。）

    控制台和文件输出的默认模式是 `%D{%Y-%m-%dT %H:%M:%SZ}|%05N|%c|%p|%m`；对于 syslog 输出，是 `%05N|%c|%p|%m`。

-   `vlog/set FACILITY:facility`
    设置日志消息的 RFC5424 设施。`facility` 可以是 `kern`, `user`, `mail`, `daemon`, `auth`, `syslog`, `lpr`, `news`, `uucp`, `clock`, `ftp`, `ntp`, `audit`, `alert`, `clock2`, `local0`, `local1`, `local2`, `local3`, `local4`, `local5`, `local6` 或 `local7` 之一。

-   `vlog/close`
    导致守护进程关闭其日志文件（如果已打开）。（使用 `vlog/reopen` 稍后重新打开它。）

-   `vlog/reopen`
    导致守护进程关闭其日志文件（如果已打开），然后重新打开它。（这在轮换日志文件后很有用，以使新日志文件被使用。）

    如果目标应用程序未使用 `--log-file` 选项调用，则此操作无效。

## 选项

-   `-h`, `--help`
    将简短的帮助消息打印到控制台。

-   `-V`, `--version`
    将版本信息打印到控制台。
